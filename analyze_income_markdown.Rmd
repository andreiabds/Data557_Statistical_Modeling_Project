---
title: "Income v. Relationship Quality"
author: "Karl Stavem"
date: "3/2/2020"
output: html_document
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)
rm(list = ls())

# Load in the raw rda file
load('./30103-0001-Data.rda')

# Give data a friendly name
df <- da30103.0001

# look at column names
names(df)

keeps <- c('RESPONDENT_YRSED',# Approx Respondent yrs education based on ppeduc, first demographic survey
           'PARTNER_YRSED',   # Partner yrs education based on q10
           'PPINCIMP',        # Binned - total combined household income
           'PPWORK',          # employment
           'QFLAG',           # does person have a partner?
           'PAPGLB_STATUS',   # (gay, lesbian, or bisexual)
           'PPMARIT',         # marital status
           'PPGENDER',        # gender
           'Q4',              # (is partner female or male) 
           'Q5',              # (is partner same gender)
           'Q23',             # between you and [partner_name], who earned more income in 2008
           'PPETHM',          # race/ethnicity
           'Q6B',             # race of partner
           'RESPONDENT_RACE',
           'PARTNER_RACE',
           'RELATIONSHIP_QUALITY' # relationship quality, based on q34, higher number is better
)

# store as new df
df <- df[keeps]

# only keep the partnered people
df <- df[df$QFLAG=='(1) partnered',]

# add a new column to track difference in education
df['diff_in_education'] = df$RESPONDENT_YRSED - df$PARTNER_YRSED

# add boolean to track difference in race
df['diff_in_race'] = ifelse(df$RESPONDENT_RACE == df$PARTNER_RACE, 0, 1)

# add boolean to track difference in income
df['diff_in_income'] = ifelse(df$Q23 == '(2) we earned about the same amount', 0, 1)

```

# Topic 2: How does income/income disparity affect relationship outcomes over time? And how does total income affect relationship length?

First, we need to create a few additional fields to run our analysis.

```{r}

# clean up the income column - grab the number associated with each category
df$income_val <- as.numeric(substr(df$PPINCIMP, 2, 3))


# clean up the relationship quality column - grab the number associated with each category
df$relationship_val <- as.numeric(substr(df$RELATIONSHIP_QUALITY, 2, 2))


# create a boolean to track if couples make $75,000 or more
df$income_greater_than_75k <- as.numeric(ifelse(df$income_val >= 14, 1, 0))

```


## T-Test

---
 Hypothesis testing: Our null hypothesis is that combined income of couples of greater than $75,000 (chosen due to factors explained here: https://www.huffpost.com/entry/map-happiness-benchmark_n_5592194) has no effect on relationship length/quality. We will perform the test via a large sample Z-test or t-test since our sample size is sufficiently large for both. We will create a calculated field for combined income that adds Partner 1 Income to Partner 2 incomes.
---

```{r}

# split into two groups
more.than.75k.group <- df$relationship_val[df$income_greater_than_75k == 1]
less.than.75k.group <- df$relationship_val[df$income_greater_than_75k == 0]

# look at the results of the test - highly significant
model1 <- t.test(more.than.75k.group, less.than.75k.group, var.equal = FALSE)
model1

```
Looking at the results of the t-test, we can see that having income above 75,000 is highly significant with regard to relationship quality.  Here we see a very small p-value of `r model1$p.value`.


Since have turned the income variable into a simple categorical variable with only two levels (75k and over, or less than 75k), then the simple regression analysis is equivalent to an independent t test.


```{r}
# linear model on a two variable test is equivalent to a two sample t-test
model2 <- summary(lm(relationship_val ~ income_greater_than_75k, data = df))
model2
```

Here we can see a highly significant result.   As individuals move from the less than 75k group to the above 75k group, on average, the mean relationship quality improves by `r round(model2$coefficients['income_greater_than_75k', 'Estimate'], 4)`.


## Linear Models
Linear regression: we will create a linear regression model using income as the predictor variable and relationship length/quality as the outcome variable and examine the strength of the income coefficient, as well as the correlation between income and relationship length.
